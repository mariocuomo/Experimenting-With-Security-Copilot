{
    "contentVersion": "1.0.0.0",
    "parameters": {
      "workspaceName": {
          "type": "string",
          "metadata": {
              "description": "Workspace name for Log Analytics where Sentinel is setup"
          }
      },
      "workbookId": {
        "type": "string",
        "defaultValue": "[newGuid()]",
        "metadata": {
          "description": "The unique guid for this workbook instance"
        }
      }
    },
    "variables": {
      "workbookSourceId": "[concat(subscription().id,'/resourcegroups/',resourceGroup().name,'/providers/microsoft.operationalinsights/workspaces/',parameters('workspaceName'))]"
    },
    "resources": [
      {
        "name": "[parameters('workbookId')]",
        "type": "microsoft.insights/workbooks",
        "location": "[resourceGroup().location]",
        "apiVersion": "2022-04-01",
        "dependsOn": [],
        "kind": "shared",
        "properties": {
          "displayName": "Security Copilot SCUs Consumption Analysis Workbook",
          "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Info & Prerequisites\",\"expandable\":true,\"items\":[{\"type\":1,\"content\":{\"json\":\"Leverage on this workbook to analyze how Security Copilot is used in your organization based on the SCUs consumption data. <br>n1. Download the [Usage Monitoring report](https://learn.microsoft.com/en-us/copilot/security/manage-usage) from the Security Copilot Standalone portal.<br> n2. Run [powershell script](https://github.com/mariocuomo) <br> n3. Upload the watchlist **SecurityCopilotUsageData** in Sentinel\\r\\n\\r\\nVersion: 1.0 <br>\\r\\nAuthor: [Mario Cuomo](https://github.com/mariocuomo)\"},\"name\":\"text - 0\"}]},\"name\":\"Prerequisites\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"tabs\",\"links\":[{\"id\":\"9df496a9-28d6-40eb-81ec-3a856c91ad74\",\"cellValue\":\"tabvisualization\",\"linkTarget\":\"parameter\",\"linkLabel\":\"User Analysis\",\"subTarget\":\"users\",\"style\":\"link\"},{\"id\":\"e3ad5e8f-fce1-4606-8195-294fba60e09f\",\"cellValue\":\"tabvisualization\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Plugin Analysis\",\"subTarget\":\"plugins\",\"style\":\"link\"},{\"id\":\"22653d13-09c3-4972-b6ca-7350762a43c4\",\"cellValue\":\"tabvisualization\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Session Analysis\",\"subTarget\":\"sessions\",\"style\":\"link\"}]},\"name\":\"links - 14\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"User Analysis\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"_GetWatchlist('SecurityCopilotUsageData')\\r\\n| summarize count() by InitiatedBy\\r\\n| sort by count_ desc\\r\\n\",\"size\":0,\"title\":\"Interactions by User\",\"timeContext\":{\"durationMs\":86400000},\"exportFieldName\":\"\",\"exportParameterName\":\"user\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\"},\"name\":\"query - 2\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"_GetWatchlist('SecurityCopilotUsageData')\\r\\n| summarize sum(todouble(UnitsUsed)) by InitiatedBy\\r\\n| sort by sum_UnitsUsed desc\\r\\n\",\"size\":0,\"title\":\"SCUs by User\",\"timeContext\":{\"durationMs\":86400000},\"exportFieldName\":\"\",\"exportParameterName\":\"user\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\"},\"name\":\"query - 2 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"_GetWatchlist('SecurityCopilotUsageData')\\r\\n| project TimeGenerated, InitiatedBy, Category, CopilotExperience, PluginsUsed, SessionID, UnitsUsed\\r\\n| summarize count(), sum(todouble(UnitsUsed)) by InitiatedBy\\r\\n\",\"size\":0,\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"sortBy\":[{\"itemKey\":\"count_\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"count_\",\"sortOrder\":2}]},\"name\":\"query - 14\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"b4d4dbdb-e413-43e7-8e57-cbd20cc10b5e\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"SelectedUser\",\"label\":\"User\",\"type\":2,\"query\":\"_GetWatchlist('SecurityCopilotUsageData')\\r\\n| project TimeGenerated, InitiatedBy, Category, CopilotExperience, PluginsUsed, SessionID, UnitsUsed\\r\\n| distinct InitiatedBy\\r\\n| order by InitiatedBy asc\",\"typeSettings\":{\"additionalResourceOptions\":[]},\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":null}],\"style\":\"formHorizontal\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 13\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"_GetWatchlist('SecurityCopilotUsageData')\\r\\n| take 1\\r\\n| extend User = strcat(\\\"statistics for \\\", '{SelectedUser}')\\r\\n| project User\",\"size\":4,\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"stat\",\"textSettings\":{\"style\":\"markdown\"}},\"name\":\"query - 5\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"_GetWatchlist('SecurityCopilotUsageData')\\r\\n| where InitiatedBy == '{SelectedUser}'\\r\\n| project TimeGenerated, InitiatedBy, Category, CopilotExperience, PluginsUsed, SessionID, UnitsUsed\\r\\n| summarize SCUs_Used=sum(todouble(UnitsUsed)), Plugins_Used=makeset(PluginsUsed), Copilot_Experiences=makeset(CopilotExperience), Categories=makeset(Category), Session_Ids=makeset(SessionID)\\r\\n\",\"size\":4,\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"sortBy\":[{\"itemKey\":\"Session_Ids\",\"sortOrder\":1}]},\"sortBy\":[{\"itemKey\":\"Session_Ids\",\"sortOrder\":1}],\"tileSettings\":{\"showBorder\":false},\"graphSettings\":{\"type\":0},\"mapSettings\":{\"locInfo\":\"LatLong\",\"sizeSettings\":\"sum_UnitsUsed\",\"sizeAggregation\":\"Sum\",\"legendMetric\":\"sum_UnitsUsed\",\"legendAggregation\":\"Sum\",\"itemColorSettings\":{\"type\":\"heatmap\",\"colorAggregation\":\"Sum\",\"nodeColorField\":\"sum_UnitsUsed\",\"heatmapPalette\":\"greenRed\"}}},\"name\":\"query - 4\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"_GetWatchlist('SecurityCopilotUsageData')\\r\\n| where InitiatedBy == '{SelectedUser}'\\r\\n| project TimeGenerated, InitiatedBy, Category, CopilotExperience, PluginsUsed, SessionID, UnitsUsed\\r\\n| summarize count() by PluginsUsed\",\"size\":0,\"title\":\"Interactions by Plugin\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"25\",\"name\":\"query - 6\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"_GetWatchlist('SecurityCopilotUsageData')\\r\\n| where InitiatedBy == '{SelectedUser}'\\r\\n| project TimeGenerated, InitiatedBy, Category, CopilotExperience, PluginsUsed, SessionID, UnitsUsed\\r\\n| summarize count() by CopilotExperience\",\"size\":0,\"title\":\"Interactions by Experience\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"25\",\"name\":\"query - 7\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"_GetWatchlist('SecurityCopilotUsageData')\\r\\n| where InitiatedBy == '{SelectedUser}'\\r\\n| project TimeGenerated, InitiatedBy, Category, CopilotExperience, PluginsUsed, SessionID, UnitsUsed\\r\\n| summarize count() by Category\",\"size\":0,\"title\":\"Interactions by Category\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"25\",\"name\":\"query - 8\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"_GetWatchlist('SecurityCopilotUsageData')\\r\\n| where InitiatedBy == '{SelectedUser}'\\r\\n| project TimeGenerated, InitiatedBy, Category, CopilotExperience, PluginsUsed, SessionID, UnitsUsed\\r\\n| summarize count() by SessionID\\r\\n| top 10 by count_\\r\\n| extend SessionID = tostring(SessionID)\\r\\n\",\"size\":0,\"title\":\"Interactions by Session\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"gridSettings\":{\"sortBy\":[{\"itemKey\":\"count_\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"count_\",\"sortOrder\":2}]},\"customWidth\":\"25\",\"name\":\"query - 9\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"_GetWatchlist('SecurityCopilotUsageData')\\r\\n| where InitiatedBy == '{SelectedUser}'\\r\\n| project TimeGenerated, InitiatedBy, Category, CopilotExperience, PluginsUsed, SessionID, UnitsUsed\\r\\n| summarize sum(todouble(UnitsUsed)) by PluginsUsed\",\"size\":0,\"title\":\"SCUs consumed by Plugin\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"25\",\"name\":\"query - 6 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"_GetWatchlist('SecurityCopilotUsageData')\\r\\n| where InitiatedBy == '{SelectedUser}'\\r\\n| project TimeGenerated, InitiatedBy, Category, CopilotExperience, PluginsUsed, SessionID, UnitsUsed\\r\\n| summarize sum(todouble(UnitsUsed)) by CopilotExperience\",\"size\":0,\"title\":\"SCUs consumed by Experience\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"25\",\"name\":\"query - 7 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"_GetWatchlist('SecurityCopilotUsageData')\\r\\n| where InitiatedBy == '{SelectedUser}'\\r\\n| project TimeGenerated, InitiatedBy, Category, CopilotExperience, PluginsUsed, SessionID, UnitsUsed\\r\\n| summarize sum(todouble(UnitsUsed)) by Category\",\"size\":0,\"title\":\"SCUs consumed by Category\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"25\",\"name\":\"query - 8 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"_GetWatchlist('SecurityCopilotUsageData')\\r\\n| where InitiatedBy == '{SelectedUser}'\\r\\n| project TimeGenerated, InitiatedBy, Category, CopilotExperience, PluginsUsed, SessionID, UnitsUsed\\r\\n| summarize sum(todouble(UnitsUsed)) by SessionID\\r\\n| top 10 by sum_UnitsUsed\\r\\n| extend SessionID = tostring(SessionID)\\r\\n\",\"size\":0,\"title\":\"SCUs consumed by Session\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"gridSettings\":{\"sortBy\":[{\"itemKey\":\"count_\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"count_\",\"sortOrder\":2}]},\"customWidth\":\"25\",\"name\":\"query - 9 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"_GetWatchlist('SecurityCopilotUsageData')\\r\\n| where InitiatedBy == '{SelectedUser}'\\r\\n| project TimeGenerated, InitiatedBy, Category, CopilotExperience, PluginsUsed, SessionID, UnitsUsed\\r\\n| order by UnitsUsed desc\\r\\n\",\"size\":0,\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"query - 3\"}]},\"conditionalVisibility\":{\"parameterName\":\"tabvisualization\",\"comparison\":\"isEqualTo\",\"value\":\"users\"},\"name\":\"User Analysis\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Plugin Analysis\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"_GetWatchlist('SecurityCopilotUsageData')\\r\\n| summarize count() by PluginsUsed\\r\\n| sort by count_ desc\\r\\n\",\"size\":0,\"title\":\"Interactions by Plugins\",\"timeContext\":{\"durationMs\":86400000},\"exportFieldName\":\"\",\"exportParameterName\":\"user\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\"},\"name\":\"query - 2 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"_GetWatchlist('SecurityCopilotUsageData')\\r\\n| summarize sum(todouble(UnitsUsed)) by PluginsUsed\\r\\n| sort by sum_UnitsUsed desc\\r\\n\",\"size\":0,\"title\":\"SCUs by Plugins\",\"timeContext\":{\"durationMs\":86400000},\"exportFieldName\":\"\",\"exportParameterName\":\"user\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\"},\"name\":\"query - 2 - Copy - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"_GetWatchlist('SecurityCopilotUsageData')\\r\\n| project TimeGenerated, InitiatedBy, Category, CopilotExperience, PluginsUsed, SessionID, UnitsUsed\\r\\n| summarize count(), sum(todouble(UnitsUsed)) by PluginsUsed\\r\\n\",\"size\":0,\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"query - 14\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"3f2adc49-d62d-4e0c-9ce8-7f9f430b7dd6\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"pluginSelected\",\"label\":\"plugin\",\"type\":2,\"query\":\"_GetWatchlist('SecurityCopilotUsageData')\\r\\n| project TimeGenerated, InitiatedBy, Category, CopilotExperience, PluginsUsed, SessionID, UnitsUsed\\r\\n| distinct PluginsUsed\\r\\n| order by PluginsUsed asc\",\"typeSettings\":{\"additionalResourceOptions\":[]},\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":null}],\"style\":\"formHorizontal\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 14\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"_GetWatchlist('SecurityCopilotUsageData')\\r\\n| take 1\\r\\n| extend Plugin = strcat(\\\"statistics for \\\", '{pluginSelected}')\\r\\n| project Plugin\",\"size\":4,\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"stat\",\"textSettings\":{\"style\":\"markdown\"}},\"name\":\"query - 5\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"_GetWatchlist('SecurityCopilotUsageData')\\r\\n| where PluginsUsed == '{pluginSelected}'\\r\\n| project TimeGenerated, InitiatedBy, Category, CopilotExperience, SessionID, UnitsUsed\\r\\n| summarize SCUs_Used=sum(todouble(UnitsUsed)), Users=makeset(InitiatedBy), Copilot_Experiences=makeset(CopilotExperience), Categories=makeset(Category), Session_Ids=makeset(SessionID)\\r\\n\",\"size\":4,\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"sortBy\":[{\"itemKey\":\"Session_Ids\",\"sortOrder\":1}]},\"sortBy\":[{\"itemKey\":\"Session_Ids\",\"sortOrder\":1}],\"tileSettings\":{\"showBorder\":false},\"graphSettings\":{\"type\":0},\"mapSettings\":{\"locInfo\":\"LatLong\",\"sizeSettings\":\"sum_UnitsUsed\",\"sizeAggregation\":\"Sum\",\"legendMetric\":\"sum_UnitsUsed\",\"legendAggregation\":\"Sum\",\"itemColorSettings\":{\"type\":\"heatmap\",\"colorAggregation\":\"Sum\",\"nodeColorField\":\"sum_UnitsUsed\",\"heatmapPalette\":\"greenRed\"}}},\"name\":\"query - 4\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"_GetWatchlist('SecurityCopilotUsageData')\\r\\n| where PluginsUsed == '{pluginSelected}'\\r\\n| project TimeGenerated, InitiatedBy, Category, CopilotExperience, PluginsUsed, SessionID, UnitsUsed\\r\\n| summarize count() by InitiatedBy\",\"size\":0,\"title\":\"Interactions by User\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"25\",\"name\":\"query - 6\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"_GetWatchlist('SecurityCopilotUsageData')\\r\\n| where PluginsUsed == '{pluginSelected}'\\r\\n| project TimeGenerated, InitiatedBy, Category, CopilotExperience, PluginsUsed, SessionID, UnitsUsed\\r\\n| summarize count() by CopilotExperience\",\"size\":0,\"title\":\"Interactions by Experience\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"25\",\"name\":\"query - 7\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"_GetWatchlist('SecurityCopilotUsageData')\\r\\n| where PluginsUsed == '{pluginSelected}'\\r\\n| project TimeGenerated, InitiatedBy, Category, CopilotExperience, PluginsUsed, SessionID, UnitsUsed\\r\\n| summarize count() by Category\",\"size\":0,\"title\":\"Interactions by Category\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"25\",\"name\":\"query - 8\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"_GetWatchlist('SecurityCopilotUsageData')\\r\\n| where PluginsUsed == '{pluginSelected}'\\r\\n| project TimeGenerated, InitiatedBy, Category, CopilotExperience, PluginsUsed, SessionID, UnitsUsed\\r\\n| summarize count() by SessionID\\r\\n| top 10 by count_\\r\\n| extend SessionID = tostring(SessionID)\\r\\n\",\"size\":0,\"title\":\"Interactions by Session\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"gridSettings\":{\"sortBy\":[{\"itemKey\":\"count_\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"count_\",\"sortOrder\":2}]},\"customWidth\":\"25\",\"name\":\"query - 9\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"_GetWatchlist('SecurityCopilotUsageData')\\r\\n| where PluginsUsed == '{pluginSelected}'\\r\\n| project TimeGenerated, InitiatedBy, Category, CopilotExperience, PluginsUsed, SessionID, UnitsUsed\\r\\n| summarize sum(todouble(UnitsUsed)) by InitiatedBy\",\"size\":0,\"title\":\"SCUs consumed by User\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"25\",\"name\":\"query - 6 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"_GetWatchlist('SecurityCopilotUsageData')\\r\\n| where PluginsUsed == '{pluginSelected}'\\r\\n| project TimeGenerated, InitiatedBy, Category, CopilotExperience, PluginsUsed, SessionID, UnitsUsed\\r\\n| summarize sum(todouble(UnitsUsed)) by CopilotExperience\",\"size\":0,\"title\":\"SCUs consumed by Experience\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"25\",\"name\":\"query - 7 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"_GetWatchlist('SecurityCopilotUsageData')\\r\\n| where PluginsUsed == '{pluginSelected}'\\r\\n| project TimeGenerated, InitiatedBy, Category, CopilotExperience, PluginsUsed, SessionID, UnitsUsed\\r\\n| summarize sum(todouble(UnitsUsed)) by Category\",\"size\":0,\"title\":\"SCUs consumed by Category\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"25\",\"name\":\"query - 8 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"_GetWatchlist('SecurityCopilotUsageData')\\r\\n| where PluginsUsed == '{pluginSelected}'\\r\\n| project TimeGenerated, InitiatedBy, Category, CopilotExperience, PluginsUsed, SessionID, UnitsUsed\\r\\n| summarize sum(todouble(UnitsUsed)) by SessionID\\r\\n| top 10 by sum_UnitsUsed\\r\\n| extend SessionID = tostring(SessionID)\\r\\n\",\"size\":0,\"title\":\"SCUs consumed by Session\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"gridSettings\":{\"sortBy\":[{\"itemKey\":\"count_\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"count_\",\"sortOrder\":2}]},\"customWidth\":\"25\",\"name\":\"query - 9 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"_GetWatchlist('SecurityCopilotUsageData')\\r\\n| where PluginsUsed == '{pluginSelected}'\\r\\n| project TimeGenerated, InitiatedBy, Category, CopilotExperience, SessionID, UnitsUsed\\r\\n| order by UnitsUsed desc\\r\\n\",\"size\":0,\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"query - 3\"}]},\"conditionalVisibility\":{\"parameterName\":\"tabvisualization\",\"comparison\":\"isEqualTo\",\"value\":\"plugins\"},\"name\":\"Plugin Analysis\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Session Analysis\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"_GetWatchlist('SecurityCopilotUsageData')\\r\\n| summarize count() by SessionID\\r\\n| extend SessionID = tostring(SessionID)\\r\\n| sort by count_ desc\\r\\n| top 10 by count_\\r\\n\",\"size\":0,\"title\":\"Interactions by SessionID\",\"timeContext\":{\"durationMs\":86400000},\"exportFieldName\":\"\",\"exportParameterName\":\"plugin\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\"},\"name\":\"query - 2\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"_GetWatchlist('SecurityCopilotUsageData')\\r\\n| summarize sum(todouble(UnitsUsed)) by SessionID\\r\\n| extend SessionID = tostring(SessionID)\\r\\n| sort by sum_UnitsUsed desc\\r\\n| top 10 by sum_UnitsUsed\\r\\n\",\"size\":0,\"title\":\"SCUs by SessionID\",\"timeContext\":{\"durationMs\":86400000},\"exportFieldName\":\"\",\"exportParameterName\":\"plugin\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\"},\"name\":\"query - 2 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"_GetWatchlist('SecurityCopilotUsageData')\\r\\n| project TimeGenerated, InitiatedBy, Category, CopilotExperience, PluginsUsed, SessionID, UnitsUsed\\r\\n| summarize count(), sum(todouble(UnitsUsed)) by SessionID\\r\\n\",\"size\":0,\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"query - 14\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"1a9839f2-ea81-41cc-bb80-80602e76a31e\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"sessionID\",\"type\":2,\"query\":\"_GetWatchlist('SecurityCopilotUsageData')\\r\\n| project TimeGenerated, InitiatedBy, Category, CopilotExperience, PluginsUsed, SessionID, UnitsUsed\\r\\n| distinct SessionID\\r\\n| sort by SessionID asc\\r\\n\",\"typeSettings\":{\"additionalResourceOptions\":[],\"showDefault\":false},\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":null}],\"style\":\"formHorizontal\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 12\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"_GetWatchlist('SecurityCopilotUsageData')\\r\\n| take 1\\r\\n| extend Plugin = strcat('statistics for Session ','{sessionID}')\\r\\n| project Plugin\",\"size\":4,\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"stat\",\"textSettings\":{\"style\":\"markdown\"}},\"name\":\"query - 5\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"_GetWatchlist('SecurityCopilotUsageData')\\r\\n| where SessionID == '{sessionID}'\\r\\n| project TimeGenerated, InitiatedBy, Category, CopilotExperience, PluginsUsed, UnitsUsed\\r\\n| summarize SCUs_Used=sum(todouble(UnitsUsed)), Users=makeset(InitiatedBy), Copilot_Experiences=makeset(CopilotExperience), Categories=makeset(Category), Plugins=makeset(PluginsUsed)\\r\\n\",\"size\":4,\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"sortBy\":[{\"itemKey\":\"SCUs_Used\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"SCUs_Used\",\"sortOrder\":2}],\"tileSettings\":{\"showBorder\":false},\"graphSettings\":{\"type\":0},\"mapSettings\":{\"locInfo\":\"LatLong\",\"sizeSettings\":\"sum_UnitsUsed\",\"sizeAggregation\":\"Sum\",\"legendMetric\":\"sum_UnitsUsed\",\"legendAggregation\":\"Sum\",\"itemColorSettings\":{\"type\":\"heatmap\",\"colorAggregation\":\"Sum\",\"nodeColorField\":\"sum_UnitsUsed\",\"heatmapPalette\":\"greenRed\"}}},\"name\":\"query - 4\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"_GetWatchlist('SecurityCopilotUsageData')\\r\\n| where SessionID == '{sessionID}'\\r\\n| project TimeGenerated, InitiatedBy, Category, CopilotExperience, PluginsUsed, SessionID, UnitsUsed\\r\\n| summarize count() by InitiatedBy\",\"size\":0,\"title\":\"Interactions by User\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"25\",\"name\":\"query - 6\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"_GetWatchlist('SecurityCopilotUsageData')\\r\\n| where SessionID == '{sessionID}'\\r\\n| project TimeGenerated, InitiatedBy, Category, CopilotExperience, PluginsUsed, SessionID, UnitsUsed\\r\\n| summarize count() by CopilotExperience\",\"size\":0,\"title\":\"Interactions by Experience\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"25\",\"name\":\"query - 7\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"_GetWatchlist('SecurityCopilotUsageData')\\r\\n| where SessionID == '{sessionID}'\\r\\n| project TimeGenerated, InitiatedBy, Category, CopilotExperience, PluginsUsed, SessionID, UnitsUsed\\r\\n| summarize count() by Category\",\"size\":0,\"title\":\"Interactions by Category\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"25\",\"name\":\"query - 8\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"_GetWatchlist('SecurityCopilotUsageData')\\r\\n| where SessionID == '{sessionID}'\\r\\n| project TimeGenerated, InitiatedBy, Category, CopilotExperience, PluginsUsed, SessionID, UnitsUsed\\r\\n| summarize count() by PluginsUsed\\r\\n| top 10 by count_\\r\\n\",\"size\":0,\"title\":\"Interactions by Plugin\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"gridSettings\":{\"sortBy\":[{\"itemKey\":\"count_\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"count_\",\"sortOrder\":2}]},\"customWidth\":\"25\",\"name\":\"query - 9\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"_GetWatchlist('SecurityCopilotUsageData')\\r\\n| where SessionID == '{sessionID}'\\r\\n| project TimeGenerated, InitiatedBy, Category, CopilotExperience, PluginsUsed, SessionID, UnitsUsed\\r\\n| summarize sum(todouble(UnitsUsed)) by InitiatedBy\",\"size\":0,\"title\":\"SCUs consumed by User\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"25\",\"name\":\"query - 6 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"_GetWatchlist('SecurityCopilotUsageData')\\r\\n| where SessionID == '{sessionID}'\\r\\n| project TimeGenerated, InitiatedBy, Category, CopilotExperience, PluginsUsed, SessionID, UnitsUsed\\r\\n| summarize sum(todouble(UnitsUsed)) by CopilotExperience\",\"size\":0,\"title\":\"SCUs consumed by Experience\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"25\",\"name\":\"query - 7 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"_GetWatchlist('SecurityCopilotUsageData')\\r\\n| where SessionID == '{sessionID}'\\r\\n| project TimeGenerated, InitiatedBy, Category, CopilotExperience, PluginsUsed, SessionID, UnitsUsed\\r\\n| summarize sum(todouble(UnitsUsed)) by Category\",\"size\":0,\"title\":\"SCUs consumed by Experience\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"25\",\"name\":\"query - 8 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"_GetWatchlist('SecurityCopilotUsageData')\\r\\n| where SessionID == '{sessionID}'\\r\\n| project TimeGenerated, InitiatedBy, Category, CopilotExperience, PluginsUsed, SessionID, UnitsUsed\\r\\n| summarize sum(todouble(UnitsUsed)) by PluginsUsed\\r\\n| top 10 by sum_UnitsUsed\\r\\n\",\"size\":0,\"title\":\"SCUs consumed by Plugin\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"gridSettings\":{\"sortBy\":[{\"itemKey\":\"count_\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"count_\",\"sortOrder\":2}]},\"customWidth\":\"25\",\"name\":\"query - 9 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"_GetWatchlist('SecurityCopilotUsageData')\\r\\n| where SessionID == '{sessionID}'\\r\\n| project TimeGenerated, PluginsUsed, InitiatedBy, Category, CopilotExperience, UnitsUsed\\r\\n| order by UnitsUsed desc\\r\\n\",\"size\":0,\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"query - 3\"}]},\"conditionalVisibility\":{\"parameterName\":\"tabvisualization\",\"comparison\":\"isEqualTo\",\"value\":\"sessions\"},\"name\":\"Session Analysis\"}],\"isLocked\":false,\"fallbackResourceIds\":[\"/subscriptions/4f4475d8-fd3a-4f14-94b7-861e34f0d7f4/resourcegroups/sentinelrg/providers/microsoft.operationalinsights/workspaces/lawsentinel\"],\"fromTemplateId\":\"sentinel-UserWorkbook\"}",
          "version": "1.0",
          "sourceId": "[variables('workbookSourceId')]",
          "category": "sentinel"
        }
      },
      {
        "name": "[concat(parameters('workspaceName'), '/Microsoft.SecurityInsights/SecurityCopilotUsageData')]",
        "type": "Microsoft.OperationalInsights/workspaces/providers/Watchlists",
        "kind": "",
        "properties": {
            "displayName": "SecurityCopilotUsageData",
            "source": "csv",
            "description": "SecurityCopilotUsageData",
            "provider": "Microsoft",
            "isDeleted": false,
            "labels": [
            ],
            "defaultDuration": "P1000Y",
            "contentType": "Text/Csv",
            "numberOfLinesToSkip": 0,
            "itemsSearchKey": "SessionID",
            "rawContent": "<YOUR rawContent.txt AS IT IS"
        },
        "apiVersion": "2022-08-01"
      }
    ],
    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#"
  }
  